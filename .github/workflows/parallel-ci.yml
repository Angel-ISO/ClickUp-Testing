name: Parallel CI

on:
  push:
    branches: [ main, Ci-Integration ]
  pull_request:
    branches: [ main, Ci-Integration ]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    - run: npm ci
    - run: npm run lint 

  test-folders:
    runs-on: ubuntu-latest
    env:
      CLICKUP_TOKEN: ${{ secrets.CLICKUP_TOKEN }}
      CLICKUP_BASE_URL: ${{ secrets.CLICKUP_BASE_URL }}
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    - run: npm ci
    - run: npm run test:funcionalidad:folders
    - uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-reports-folders
        path: |
          reports/junit/junit.xml
          reports/html/
          reports/json/

  test-tasks:
    runs-on: ubuntu-latest
    env:
      CLICKUP_TOKEN: ${{ secrets.CLICKUP_TOKEN }}
      CLICKUP_BASE_URL: ${{ secrets.CLICKUP_BASE_URL }}
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    - run: npm ci
    - run: npm run test:funcionalidad:tasks
    - uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-reports-tasks
        path: |
          reports/junit/junit.xml
          reports/html/
          reports/json/

  test-tags:
    runs-on: ubuntu-latest
    env:
      CLICKUP_TOKEN: ${{ secrets.CLICKUP_TOKEN }}
      CLICKUP_BASE_URL: ${{ secrets.CLICKUP_BASE_URL }}
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    - run: npm ci
    - run: npm run test:funcionalidad:tags
    - uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-reports-tags
        path: |
          reports/junit/junit.xml
          reports/html/
          reports/json/

  test-comments:
    runs-on: ubuntu-latest
    env:
      CLICKUP_TOKEN: ${{ secrets.CLICKUP_TOKEN }}
      CLICKUP_BASE_URL: ${{ secrets.CLICKUP_BASE_URL }}
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    - run: npm ci
    - run: npm run test:funcionalidad:comments || true
    - uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-reports-comments
        path: |
          reports/junit/junit.xml
          reports/html/
          reports/json/

  test-lists:
    runs-on: ubuntu-latest
    env:
      CLICKUP_TOKEN: ${{ secrets.CLICKUP_TOKEN }}
      CLICKUP_BASE_URL: ${{ secrets.CLICKUP_BASE_URL }}
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    - run: npm ci
    - run: npm run test:funcionalidad:lists
    - uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-reports-lists
        path: |
          reports/junit/junit.xml
          reports/html/
          reports/json/